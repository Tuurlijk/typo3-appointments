config.tx_extbase.objects {
	Tx_Appointments_Service_CsrfProtectServiceInterface {
		className = Tx_Appointments_Service_Typo3CsrfProtectService
	}
}

plugin.tx_appointments {
	view {
		templateRootPath = {$plugin.tx_appointments.view.templateRootPath}
		partialRootPath = {$plugin.tx_appointments.view.partialRootPath}
		layoutRootPath = {$plugin.tx_appointments.view.layoutRootPath}
	}
	persistence {
		storagePid = {$plugin.tx_appointments.persistence.storagePid}
		classes {
			Tx_Appointments_Domain_Model_Appointment {
				mapping.columns {
					crdate.mapOnProperty = crdate
				}
			}
			Tx_Appointments_Domain_Model_FormField {
				mapping.columns {
					sorting.mapOnProperty = sorting
				}
			}
			Tx_Appointments_Domain_Model_Address {
				mapping.columns {
					tx_appointments_social_security_number.mapOnProperty = socialSecurityNumber
					tx_appointments_creation_progress.mapOnProperty = creationProgress
				}
			}
		
			Tx_Appointments_Domain_Model_Address {
				mapping {
					tableName = tt_address
					recordType = Tx_Appointments_Domain_Model_Address
				}
			}
			Tx_Appointments_Domain_Model_FrontendUser {
				mapping.tableName = fe_users
			}
			Tx_Appointments_Domain_Model_FrontendUserGroup {
				mapping.tableName = fe_groups
			}
		}
	}
	jslib {
		jQuery.external = 1
		jQuery = {$plugin.tx_appointments.js.jQueryCDN}
		#TYPO3 4.6.0, http://forge.typo3.org/issues/29695 resolved? Clearly not, so for now:
		jQuery.disableCompression = 1
		
		jQueryUI.external = 0
		jQueryUI = {$plugin.tx_appointments.js.uiLibFile}
		jQueryUI.disableCompression = 1
		jQueryUIcss.external = 0
		jQueryUIcss = {$plugin.tx_appointments.js.uiCssFile}
		jQueryUIcss.disableCompression = 1
		
		inlineJS = TEMPLATE
		inlineJS.template = FILE
		inlineJS.template.file = {$plugin.tx_appointments.js.libFile}
		inlineJS.marks {
			XHR_PAGETYPE = TEXT
			XHR_PAGETYPE.value = {$plugin.tx_appointments.settings.type.xhr}
			XHR_PAGEID = TEXT
			XHR_PAGEID.value = {$plugin.tx_appointments.settings.pages.xhr}
			WARN_ON_LEAVE = TEXT
			WARN_ON_LEAVE.value = {$plugin.tx_appointments.js.warnOnLeave}
			WARN_ON_LEAVE_RESPECT_REFRESH = TEXT
			WARN_ON_LEAVE_RESPECT_REFRESH.value = {$plugin.tx_appointments.js.warnOnLeaveRespectRefreshMethod}
			WARN_UNLOAD = TEXT
			WARN_UNLOAD.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.warn_unload
			WARN_UNLOAD_S1 = TEXT
			WARN_UNLOAD_S1.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.submit_new
			DELETE_CONFIRM = TEXT
			DELETE_CONFIRM.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.appointment_delete_confirm
			TIMER_ZERO = TEXT
			TIMER_ZERO.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.appointment_expired
			TIMER_ZERO_HEAD = TEXT
			TIMER_ZERO_HEAD.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.appointment_expired_header
			RENEW_TIME = TEXT
			RENEW_TIME.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.submit_time_expired
			DAY1 = TEXT
			DAY1.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.day_s1
			DAY2 = TEXT
			DAY2.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.day_s2
			DAY3 = TEXT
			DAY3.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.day_s3
			DAY4 = TEXT
			DAY4.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.day_s4
			DAY5 = TEXT
			DAY5.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.day_s5
			DAY6 = TEXT
			DAY6.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.day_s6
			DAY7 = TEXT
			DAY7.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_list.day_s7
			MON1 = TEXT
			MON1.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s1
			MON2 = TEXT
			MON2.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s2
			MON3 = TEXT
			MON3.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s3
			MON4 = TEXT
			MON4.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s4
			MON5 = TEXT
			MON5.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s5
			MON6 = TEXT
			MON6.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s6
			MON7 = TEXT
			MON7.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s7
			MON8 = TEXT
			MON8.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s8
			MON9 = TEXT
			MON9.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s9
			MON10 = TEXT
			MON10.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s10
			MON11 = TEXT
			MON11.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s11
			MON12 = TEXT
			MON12.data = LLL:EXT:appointments/Resources/Private/Language/locallang.xml:tx_appointments_agenda.month_s12
		}
	}
	settings {
		type {
			xhr = {$plugin.tx_appointments.settings.type.xhr}
		}
		agendaUid = {$plugin.tx_appointments.settings.agendaUid}
		allowCreate = {$plugin.tx_appointments.settings.allowCreate}
		agendaBack = {$plugin.tx_appointments.settings.agendaBack}
		agendaForward = {$plugin.tx_appointments.settings.agendaForward}
		agendaWeeksBeforeCurrent = {$plugin.tx_appointments.settings.agendaWeeksBeforeCurrent}
		agendaWeeksAfterCurrent = {$plugin.tx_appointments.settings.agendaWeeksAfterCurrent}
		freeSlotInMinutes = {$plugin.tx_appointments.settings.freeSlotInMinutes}
		shiftSlotPerInterval = {$plugin.tx_appointments.settings.shiftSlotPerInterval}
		suGroup = {$plugin.tx_appointments.settings.suGroup}
		redirectAfterSave = {$plugin.tx_appointments.settings.redirectAfterSave}
		allowResume = {$plugin.tx_appointments.settings.allowResume}
	}
	tsOverride {
		checkFields = agendaUid,appointmentTypeList,suGroup,allowCreate
		selectFields = agendaNavOverride
	}
	features {
		# @TODO support before TYPO3 7.0 release
		rewrittenPropertyMapper = 0
	}
	objects {
		# extbase 6.1+ bugfix for rewrittenPropertyMapper=0
		TYPO3\CMS\Extbase\Persistence\Generic\PersistenceManager {
			className = Innologi\Appointments\Persistence\PersistenceManager
		}
		TYPO3\CMS\Extbase\Persistence\PersistenceManagerInterface {
			className = Innologi\Appointments\Persistence\PersistenceManagerInterface
		}
		# extbase 6.2+ bugfix for rewrittenPropertyMapper=0
		TYPO3\CMS\Extbase\Validation\ValidatorResolver {
			className = Tx_Appointments_Validation_ValidatorResolver
		}
	}
}

module.tx_appointments.persistence < plugin.tx_appointments.persistence

[globalVar = LIT:0 < {$plugin.tx_appointments.js.includeJquery}] && [globalVar = LIT:0 < {$plugin.tx_appointments.js.toFooter}] 
page.includeJSFooterlibs.appointments_jQuery < plugin.tx_appointments.jslib.jQuery

[globalVar = LIT:0 < {$plugin.tx_appointments.js.includeJquery}] && [globalVar = LIT:1 > {$plugin.tx_appointments.js.toFooter}] 
page.includeJSlibs.appointments_jQuery < plugin.tx_appointments.jslib.jQuery

[globalVar = LIT:0 < {$plugin.tx_appointments.js.includeJqueryUI}] && [globalVar = LIT:0 < {$plugin.tx_appointments.js.toFooter}] 
page.includeJSFooterlibs.appointments_jQueryUI < plugin.tx_appointments.jslib.jQueryUI
page.includeCSS.appointments_jQueryUI < plugin.tx_appointments.jslib.jQueryUIcss

[globalVar = LIT:0 < {$plugin.tx_appointments.js.includeJqueryUI}] && [globalVar = LIT:1 > {$plugin.tx_appointments.js.toFooter}] 
page.includeJSlibs.appointments_jQueryUI < plugin.tx_appointments.jslib.jQueryUI
page.includeCSS.appointments_jQueryUI < plugin.tx_appointments.jslib.jQueryUIcss

[globalVar = LIT:0 < {$plugin.tx_appointments.js.includeJS}] && [globalVar = LIT:0 < {$plugin.tx_appointments.js.toFooter}]
page.jsFooterInline.198311210 < plugin.tx_appointments.jslib.inlineJS

[globalVar = LIT:0 < {$plugin.tx_appointments.js.includeJS}] && [globalVar = LIT:1 > {$plugin.tx_appointments.js.toFooter}]
page.jsInline.198311210 < plugin.tx_appointments.jslib.inlineJS

[global]

# XHR pagetype, not using eid because of required extbase controller context
# @TODO should probably consider eid though, not having to deal with pid bullshit etc.
appointments_xhr = PAGE
appointments_xhr {
	typeNum = {$plugin.tx_appointments.settings.type.xhr}
	config {
		disableAllHeaderCode = 1
		disablePrefixComment = 1
		xhtml_cleaning = 0
		admPanel = 0
		debug = 0
		no_cache = 1
		metaCharset = utf-8
	}
	10 = COA_INT
	10 < styles.content.get
	// exclusively take list content, regardless of colPos
	10.select.where = list_type = 'appointments_list'
}

# default CSS
plugin.tx_appointments._CSS_DEFAULT_STYLE (
	.tx-appointments,
	.tx-appointments .one-button-form button {
		font-family:helvetica,arial,sans-serif;
	}
	
	.tx-appointments p {
		margin:10px 0;
	}
	
	.tx-appointments table caption {
		display:none;
	}
	
	.tx-appointments table {
		border-collapse:separate;
		border-spacing:5px;
	}
	
	.tx-appointments .header,
	.tx-appointments .single-appointment {
		margin-bottom:15px;
	}

	.tx-appointments table th {
		font-weight:bold;
		text-align:center;
	}

	.tx-appointments table td {
		vertical-align:top;
	}
	
	.tx-appointments h4 {
		margin:15px 0 10px;
	}
	
	.tx-appointments a,
	.tx-appointments .one-button-form button {
		color:#66f;
		text-decoration:none;
	}
	.tx-appointments a:hover,
	.tx-appointments a:focus,
	.tx-appointments a:active,
	.tx-appointments .one-button-form button:hover,
	.tx-appointments .one-button-form button:focus,
	.tx-appointments .one-button-form button:active {
		color:#f22;
	}
	
	
	
	/* List */
	
	.tx-appointments .appointmentList .link_appointment {
		font-size:0.9em;
	}
	.tx-appointments .links .time-unreserved {
		text-decoration:line-through;
	}
	
	
	/* Agenda */
	
	.tx-appointments .agendaBar {
		border:1px solid #eee;
		text-align:center;
		font-size:1.3em;
		position:relative;
		font-weight:bold;
		padding:10px 0;
		width:99.5%;
		height:25px;
		background-color:#fafafa;
	}
	
	.tx-appointments .button_agendaBack {
		left:15px;
	}
	
	.tx-appointments .button_agendaForward {
		right:15px;
	}
	
	.tx-appointments .button_agendaBack,
	.tx-appointments .button_agendaForward {
		position:absolute;
		top:13px;
		font-size:0.8em;
		font-weight:normal;
	}
	
	.tx-appointments .agendaShow {
		width:100%;
	}
	
	.tx-appointments .button_agendaBack:before {
		content:"\2190\0000a0";
	}
	
	.tx-appointments .button_agendaForward:after {
		content:"\0000a0\2192";
	}
	
	.tx-appointments .agendaShow th {
		background-color:#e9e9e9;
		font-size:0.9em;
	}
	
	.tx-appointments .agendaShow td {
		background-color:#e9e9e9;
		padding:5px;
		height:90px;
		width:14%;
	}
	
	.tx-appointments .agendaShow .agendaDay {
		background-color:#f6f6f6;
		border:1px solid #e9e9e9;
	}
	
	.tx-appointments .agendaShow .agendaDay.current,
	.tx-appointments .agendaShow .agendaDay.current.holiday {
		background-color:#ffc;
	}
	
	.tx-appointments .agendaShow .agendaDay.holiday {
		background-color:#fee;
	}
	
	.tx-appointments .agendaShow .agendaDay.current.holiday {
		border:1px solid #fdd;
	}
	
	.tx-appointments .agendaDay .dayBar {
		background-color:#f9f9f9;
		text-align:right;
		color:#555;
		overflow:hidden;
		font-size:0.9em;
		font-weight:bold;
		padding-right:3px;
		text-transform:lowercase;
	}
	
	.tx-appointments .agendaDay > ul {
		list-style-type:none;
		line-height:1.2em;
		margin:3px 0 0 !important;
	}
	
	.tx-appointments .agendaShow .link_appointment {
		font-size:0.8em;
	}


	/* Buttons */
	
	.tx-appointments .button_new,
	.tx-appointments .button_edit,
	.tx-appointments .button_delete,
	.tx-appointments .button_back {
		font-size:1.1em;
		display:inline-block;
	}
	.tx-appointments .agendaDay .dayBar a.button_new_datefirst {
		color:#555;
	}
	.tx-appointments .button_edit,
	.tx-appointments .button_delete {
		margin-left:15px;
	}
	
	.tx-appointments .csh {
		overflow:hidden;
		width:16px;
		height:18px;
		display:inline-block;
		position:absolute;
		margin-left:8px;
	}
	
	.tx-appointments .tooltip {
		position:absolute;
		display:inline-block;
		opacity:0.85;
		background-color:#000;
		border:1px solid #555;
		color:#fff;
		font-size:0.9em;
		max-width:240px;
		margin-left:32px;
		padding:3px 5px;
		z-index:999;
	}
	
	.tx-appointments .button_new:before,
	.tx-appointments .button_new_datefirst:before,
	.tx-appointments .button_edit:before,
	.tx-appointments .button_delete:before,
	.tx-appointments .button_back:before,
	.tx-appointments .csh:before,
	.tx-appointments .typo3-message .message-body:before,
	.tx-appointments .validation-errors .validation-header:before {
		background-image:url("/typo3conf/ext/appointments/Resources/Public/Icons/t3skin.png");
		content:"";
		float:left;
		height:16px;
		width:16px;
		margin:2px 8px 0 0;
	}
	
	.tx-appointments .button_new:before,
	.tx-appointments .button_new_datefirst:before {
		background-position:-180px 0;
	}
	.tx-appointments .button_edit:before {
		background-position:-198px 0;
	}
	.tx-appointments .button_delete:before {
		background-position:-162px -18px;
	}
	.tx-appointments .button_back:before {
		background-position:-18px -36px;
	}
	.tx-appointments .csh:before {
		background-position:-306px -54px;
	}
	
	.tx-appointments .one-button-form button {
		border:0;
		padding:0;
		background-color:transparent;
		cursor:pointer;
	}
	.tx-appointments .one-button-form fieldset {
		margin-bottom:0;
	}
	.tx-appointments .one-button-form,
	.tx-appointments .one-button-form fieldset {
		display:inline-block;
	}
	
	
	/* Forms */
	
	.tx-appointments .f3-form-error {
		background-color:#ff9f9f !important;
		border:1px solid #f00 !important;
	}
	
	.tx-appointments .formfield-wrap {
		margin-bottom:10px;
	}
	
	.tx-appointments span.warnUnload {
		display:none;
	}
	.tx-appointments .submit {
		background-color:#ccc;
		border:1px solid #999;
	}
	.tx-appointments .submit.next {
		font-weight:bold;
	}
	.tx-appointments textarea,
	.tx-appointments .textinput { 
		width:500px;
	}
	.tx-appointments .textinput.small {
		width:auto;
	}
	.tx-appointments textarea,
	.tx-appointments .textinput,
	.tx-appointments .select,
	.tx-appointments .checkbox { 
		border:1px solid #c2c2c1;
		background-color:#fafaf5;
	}
	.tx-appointments .textinput.datepicker {
		width:90px;
	}
	.tx-appointments fieldset {
		border:0;
		padding:0;
		margin-bottom:10px;
	}
	.tx-appointments .required {
		color:#f00;
	}
	
	.tx-appointments .submit.attention {
		font-weight:bold;
		color:#d00;
	}
	
	.tx-appointments .appointment-form.disabled {
		display:none;
	}
	.tx-appointments .appointment-form.disabled.visible {
		display:block;
		opacity:0.5;
	}
	
	
	/* Messages */
	
	.tx-appointments .typo3-messages {
		overflow:hidden;
	}
	
	.tx-appointments .typo3-message,
	.tx-appointments .validation-errors {
		margin:8px 0;
		padding:10px;
		min-width:100px;
		font-size:0.9em;
	}
	.tx-appointments .typo3-message {
		float:left;
		clear:both;
	}
	.tx-appointments .validation-errors {
		display:inline-block;
	}
	.tx-appointments .typo3-message ul.links,
	.tx-appointments ul.validation-error-messages {
		list-style-type:square;
	}
	
	.tx-appointments .typo3-message .message-header,
	.tx-appointments .validation-errors .validation-fieldname {
		font-weight:bold;
	}
	
	.tx-appointments .typo3-message.message-error,
	.tx-appointments .validation-errors {
		background-color:#fcb;
		border:1px solid #ea9;
		color:#a33;
	}
	
	.tx-appointments .typo3-message.message-warning {
		background-color:#ffb;
		border:1px solid #f5d588;
		color:#85510d;
	}
	
	.tx-appointments .typo3-message.message-notice {
		background-color:#e4e4e4;
		border:1px solid #d5d5d5;
		color:#443;
	}
	
	.tx-appointments .typo3-message.message-information {
		background-color:#def;
		border:1px solid #cdf;
		color:#469;
	}
	
	.tx-appointments .typo3-message.message-ok {
		background-color:#cdefc0;
		border:1px solid #b9ddaa;
		color:#3b7826;
		
	}
	
	.tx-appointments .typo3-message.message-error .message-body:before,
	.tx-appointments .validation-errors .validation-header:before {
		background-position:-306px -198px;
	}
	.tx-appointments .typo3-message.message-warning .message-body:before {
		background-position:-54px -216px;
	}
	.tx-appointments .typo3-message.message-notice .message-body:before {
		background-position:-18px -216px;
	}
	.tx-appointments .typo3-message.message-information .message-body:before {
		background-position:0 -216px;
	}
	.tx-appointments .typo3-message.message-ok .message-body:before {
		background-position:-36px -216px;
	}
	
	@keyframes flashTimer {
		0% { color:#469; }
		30% { color:#f00; }
		70% { color:#f00; }
	}
	.tx-appointments span.reservation-timer.flash {
		animation:flashTimer linear 1.5s infinite;
	}
)